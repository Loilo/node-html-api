var htmlApi=function(){"use strict";function mitt(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).map(function(e){e(n)}),(e["*"]||[]).map(function(e){e(t,n)})}}}function entries(e){return Object.keys(e).map(function(t){return[t,e[t]]})}function has(e,t){return e.includes?e.includes(t):-1!==e.indexOf(t)}function find(e,t){if(e.find)return e.find(t);for(var n=0;n<e.length;n++)if(t(e[n],n,e))return e[n]}function arrayFrom(e){if(Array.from)return Array.from(e);if(Array.isArray(e))return e.slice(0);for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}function isPlainObject(e){return"object"==typeof e&&null==e.prototype}function isCustomTypeConstraint(e){return isPlainObject(e)&&"function"==typeof e.validate&&"function"==typeof e.serialize&&"function"==typeof e.unserialize}function isValidSingleTypeConstraint(e){return has(arrayFrom(presetTypes.keys()),e)||isCustomTypeConstraint(e)}function isValidTypeConstraint(e){return Array.isArray(e)?e.length&&e.every(isValidSingleTypeConstraint):isValidSingleTypeConstraint(e)}function createMultiConstraintDetector(e){Array.isArray(e)||(e=[e]);var t=arrayFrom(presetTypes.keys());return e=e.slice(0).sort(function(e,n){var r=t.indexOf(e),i=t.indexOf(n);return r===i?0:-1===r?-1:-1===i?1:r<i?-1:1}).map(function(e){return presetTypes.has(e)?presetTypes.get(e):e}),function(t,n){return find(e,function(e){try{var r=t;return n&&(r=e.unserialize(t)),e.validate(r)}catch(e){return!1}})}}function isUndef(e){return void 0===e}function validateOptionDefinition(e){if(isValidTypeConstraint(e))return!0;if(!isPlainObject(e))throw new Error("Definition must be a type constraint or an object.");if(!isValidTypeConstraint(e.type))throw Error("Definition must have a valid type constraint");var t=createMultiConstraintDetector(e.type);if(e.required&&!isUndef(e.default))throw new Error("Option can either be required or have a default value, not both");if(e.required||!isUndef(e.default)||null===e.type||Array.isArray(e.type)&&has(e.type,null)||(Array.isArray(e.type)?e.type.push(null):e.type=[e.type,null]),!isUndef(e.default)&&!t(e.default))throw new Error("Default value is invalid")}function validateOptionsDefinition(e){if(!isPlainObject(e))throw new Error("Options definition must be a plain object");for(var t=0,n=entries(e);t<n.length;t+=1){var r=n[t],i=r[0],a=r[1];try{validateOptionDefinition(a),isValidTypeConstraint(a)&&(Array.isArray(a)?has(a,null)||a.push(null):null!==a&&(e[i]=[a,null]))}catch(e){throw new Error('Option definition for option "'+i+'" failed: '+e.message)}}}function getTypeConstraints(e){return isValidTypeConstraint(e)?Array.isArray(e)?e:isCustomTypeConstraint(e)?[e]:[presetTypes.get(e)]:Array.isArray(e.type)?e.type:isCustomTypeConstraint(e.type)?[e.type]:[presetTypes.get(e.type)]}function validateOptionValue(e,t,n){void 0===n&&(n=!1);var r=getTypeConstraints(t);if(null==e&&has(r,null))return n?null:"null";var i,a=createMultiConstraintDetector(r);if(n){var o=a(e,!0);try{i=o.unserialize(e)}catch(t){throw new Error('Invalid serialized option value "'+e+'"')}if(!o.validate(i))throw new Error('Invalid serialized option value "'+e+'"')}else{var u=a(e,!1);if(isUndef(u)||!u.validate(e))throw new Error('Invalid option value "'+e+'"');i=u.serialize(e)}return i}function getInitialValues(e,t,n){for(var r=Object.create(null),i=0,a=entries(t);i<a.length;i+=1)!function(){var t=a[i],o=t[0],u=t[1],s=e.dataset[o];if(null!=s)try{r[o]=validateOptionValue(s,u,!0)}catch(e){throw new Error('Error setting initial option "'+o+'": '+e.message)}else u.required?window.requestAnimationFrame(function(){n.emit("error",new Error('Missing required option "'+o+'"'))}):void 0!==u.default?r[o]=u.default:r[o]=null}();return r}function kebab(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()})}function camel(e){return e.replace(/-([a-z])/g,function(e,t){return t.toUpperCase()})}function createOptionsAttrList(e){return Object.keys(e).map(function(e){return"data-"+kebab(e)})}function createOptionsDefInterface(e,t,n,r){for(var i=Object.create(null),a=0,o=entries(e);a<o.length;a+=1)!function(){var e=o[a],u=e[0],s=e[1];Object.defineProperty(i,u,{get:function(){return n[u]},set:function(e){try{var n=validateOptionValue(e,s,!1);"string"==typeof n?t.dataset[u]=n:delete t.dataset[u]}catch(e){r.emit("error",new Error('Error setting option "'+u+'": '+e.message))}}})}();return i}function observeElement(e,t,n){var r=new window.MutationObserver(function(e){for(var t=0,r=e;t<r.length;t+=1){var i=r[t];"attributes"===i.type&&n(i.attributeName.slice(5),i.oldValue)}});return r.observe(e,{attributes:!0,attributeFilter:t}),r}function createMutationHandler(e,t,n,r){return function(i,a){var o=camel(i),u=t[o],s=e.dataset[o];if(s!==a)try{var l=validateOptionValue(s,u,!0),f=n[o];n[o]=l,r.emit("change",{option:o,oldValue:f,value:l})}catch(e){r.emit("error",new Error('Error setting option "'+o+'" via HTML: '+e.message))}}}function createElementObserver(e,t,n,r){return observeElement(e,createOptionsAttrList(t),createMutationHandler(e,t,n,r))}function htmlApi(e,t){if(!(e instanceof window.Element))throw new Error("No valid Element given");validateOptionsDefinition(t);var n=mitt(),r=getInitialValues(e,t,n),i=createElementObserver(e,t,r,n),a=Object.create(null);return n.on("change",function(e){var t=e.option,n=e.value,r=e.oldValue;"function"==typeof a[t]&&a[t](n,r)}),{options:createOptionsDefInterface(t,e,r,n),onChange:a,on:function(e,t){return n.on(e,t),this},off:function(e,t){return n.off(e,t),this},merge:function(a){validateOptionsDefinition(a),Object.assign(t,a);var o=getInitialValues(e,a,n);return Object.assign(r,o),this.options=createOptionsDefInterface(t,e,r,n),i.disconnect(),i=createElementObserver(e,t,r,n),this},destroy:function(){i.disconnect()}}}var Map;window.Map&&window.Map.prototype.entries?Map=window.Map:(Map=function(e){e instanceof Map?e=e.entries():Array.isArray(e)||(e=[]),this._keys=e.map(function(e){return e[0]}),this._values=e.map(function(e){return e[1]})},Map.prototype.keys=function(){return this._keys.slice(0)},Map.prototype.values=function(){return this._values.slice(0)},Map.prototype.entries=function(){var e=this;return this._keys.map(function(t,n){return[t,e._values[n]]})},Map.prototype.has=function(e){return-1!==this._keys.indexOf(e)},Map.prototype.get=function(e){var t=this._keys.indexOf(e);return-1===t?void 0:this._values[t]},Map.prototype.set=function(e,t){var n=this._keys.indexOf(e);return-1===n?(this._keys.push(e),this._values.push(t)):this._values[n]=t,this},Map.prototype.delete=function(e){var t=this._keys.indexOf(e);return-1!==t&&(this._keys.splice(t,1),this._values.splice(t,1),!0)},Map.prototype.clear=function(){this._keys=[],this._values=[]},Map.prototype.forEach=function(e){return this.entries().forEach(e)},Map.prototype.size=function(){return this._keys.length}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var presetTypes=new Map([[null,{validate:function(e){return null==e},serialize:function(e){return"null"},unserialize:function(e){return JSON.parse(e)}}],[Boolean,{validate:function(e){return"boolean"==typeof e},serialize:function(e){return e?"":void 0},unserialize:function(e){if(void 0===e||"false"===e)return!1;if(""===e||"true"===e)return!0;throw new Error("Invalidly serialized Boolean")}}],[Number,{validate:function(e){return"number"==typeof e&&!isNaN(e)},serialize:function(e){return String(e)},unserialize:function(e){return+e}}],[Array,{validate:function(e){return Array.isArray(e)},serialize:function(e){return JSON.stringify(e)},unserialize:function(e){return JSON.parse(e)}}],[Object,{validate:function(e){return"object"==typeof e&&!Array.isArray(e)},serialize:function(e){return JSON.stringify(e)},unserialize:function(e){return JSON.parse(e)}}],[Function,{validate:function(e){return"function"==typeof e},serialize:function(e){return String(e)},unserialize:function(value){return eval("("+value+")")}}],[String,{validate:function(e){return"string"==typeof e},serialize:function(e){return e},unserialize:function(e){return e}}]]);htmlApi.Enum=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return{validate:function(t){return"string"==typeof t&&has(e,t)},serialize:function(e){return e},unserialize:function(e){return e}}};var numGen=function(e,t,n){return void 0===e&&(e=-1/0),void 0===t&&(t=1/0),void 0===n&&(n=!0),{validate:function(r){return(n||Number.isInteger?Number.isInteger(r):"number"==typeof r&&isFinite(r)&&Math.floor(r)===r)&&r>=e&&r<=t},serialize:function(e){return String(e)},unserialize:function(e){return+e}}};return htmlApi.Integer=Object.assign(numGen(-1/0,1/0,!1),{min:function(e){return Object.assign(numGen(e,1/0,!1),{max:function(t){return numGen(e,t,!1)}})},max:function(e){return numGen(-1/0,e,!1)}}),htmlApi.Float=Object.assign(numGen(-1/0,1/0),{min:function(e){return Object.assign(numGen(e,1/0),{max:function(t){return numGen(e,t)}})},max:function(e){return numGen(-1/0,e)}}),htmlApi}();
