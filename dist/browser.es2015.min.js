var htmlApi=function(){"use strict";function mitt(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).map(function(e){e(n)}),(e["*"]||[]).map(function(e){e(t,n)})}}}function entries(e){return Object.keys(e).map(t=>[t,e[t]])}function has(e,t){return e.includes?e.includes(t):-1!==e.indexOf(t)}function find(e,t){if(e.find)return e.find(t);for(let n=0;n<e.length;n++)if(t(e[n],n,e))return e[n]}function arrayFrom(e){if(Array.from)return Array.from(e);if(Array.isArray(e))return e.slice(0);const t=[];for(let n=0;n<e.length;n++)t.push(e[n]);return t}function isPlainObject(e){return"object"==typeof e&&null==e.prototype}function isCustomTypeConstraint(e){return isPlainObject(e)&&"function"==typeof e.validate&&"function"==typeof e.serialize&&"function"==typeof e.unserialize}function isValidSingleTypeConstraint(e){return has(arrayFrom(presetTypes.keys()),e)||isCustomTypeConstraint(e)}function isValidTypeConstraint(e){return Array.isArray(e)?e.length&&e.every(isValidSingleTypeConstraint):isValidSingleTypeConstraint(e)}function createMultiConstraintDetector(e){Array.isArray(e)||(e=[e]);const t=arrayFrom(presetTypes.keys());return e=e.slice(0).sort((e,n)=>{const r=t.indexOf(e),i=t.indexOf(n);return r===i?0:-1===r?-1:-1===i?1:r<i?-1:1}).map(e=>presetTypes.has(e)?presetTypes.get(e):e),(t,n)=>find(e,e=>{try{let r=t;return n&&(r=e.unserialize(t)),e.validate(r)}catch(e){return!1}})}function isUndef(e){return void 0===e}function validateOptionDefinition(e){if(isValidTypeConstraint(e))return!0;if(!isPlainObject(e))throw new Error("Definition must be a type constraint or an object.");{if(!isValidTypeConstraint(e.type))throw Error("Definition must have a valid type constraint");const t=createMultiConstraintDetector(e.type);if(e.required&&!isUndef(e.default))throw new Error("Option can either be required or have a default value, not both");if(!e.required&&isUndef(e.default)&&!(null===e.type||Array.isArray(e.type)&&has(e.type,null)))throw new Error("An option must either be required, have a default value or include a `null` type");if(!isUndef(e.default)&&!t(e.default))throw new Error("Default value is invalid")}}function validateOptionsDefinition(e){if(!isPlainObject(e))throw new Error("Options definition must be a plain object");for(const[t,n]of entries(e))try{validateOptionDefinition(n),isValidTypeConstraint(n)&&(Array.isArray(n)?has(n,null)||n.push(null):null!==n&&(e[t]=[n,null]))}catch(e){throw new Error(`Option definition for option "${t}" failed: ${e.message}`)}}function getTypeConstraints(e){return isValidTypeConstraint(e)?Array.isArray(e)?e:isCustomTypeConstraint(e)?[e]:[presetTypes.get(e)]:Array.isArray(e.type)?e.type:isCustomTypeConstraint(e.type)?[e.type]:[presetTypes.get(e.type)]}function validateOptionValue(e,t,n=!1){const r=getTypeConstraints(t);if(null==e&&has(r,null))return n?null:"null";let i;const a=createMultiConstraintDetector(r);if(n){const t=a(e,!0);try{i=t.unserialize(e)}catch(t){throw new Error(`Invalid serialized option value "${e}"`)}if(!t.validate(i))throw new Error(`Invalid serialized option value "${e}"`)}else{const t=a(e,!1);if(isUndef(t)||!t.validate(e))throw new Error(`Invalid option value "${e}"`);i=t.serialize(e)}return i}function getInitialValues(e,t,n){const r=Object.create(null);for(const[i,a]of entries(t)){const t=e.dataset[i];if(null!=t)try{r[i]=validateOptionValue(t,a,!0)}catch(e){throw new Error(`Error setting initial option "${i}": ${e.message}`)}else a.required?window.requestAnimationFrame(()=>{n.emit("error",new Error(`Missing required option "${i}"`))}):void 0!==a.default?r[i]=a.default:r[i]=null}return r}function kebab(e){return e.replace(/([A-Z])/g,(e,t)=>"-"+t.toLowerCase())}function camel(e){return e.replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}function createOptionsAttrList(e){return Object.keys(e).map(e=>`data-${kebab(e)}`)}function createOptionsDefInterface(e,t,n,r){const i=Object.create(null);for(const[a,o]of entries(e))Object.defineProperty(i,a,{get:()=>n[a],set(e){try{const n=validateOptionValue(e,o,!1);"string"==typeof n?t.dataset[a]=n:delete t.dataset[a]}catch(e){r.emit("error",new Error(`Error setting option "${a}": ${e.message}`))}}});return i}function observeElement(e,t,n){const r=new window.MutationObserver(e=>{for(const r of e)"attributes"===r.type&&has(t,r.attributeName)&&n(r.attributeName.slice(5),r.oldValue)});return r.observe(e,{attributes:!0}),r}function createMutationHandler(e,t,n,r){return(i,a)=>{const o=camel(i),s=t[o],l=e.dataset[o];if(l!==a)try{const e=validateOptionValue(l,s,!0),t=n[o];n[o]=e,r.emit("change",{option:o,oldValue:t,value:e})}catch(e){r.emit("error",new Error(`Error setting option "${o}" via HTML: ${e.message}`))}}}function createElementObserver(e,t,n,r){return observeElement(e,createOptionsAttrList(t),createMutationHandler(e,t,n,r))}function htmlApi(e,t){if(!(e instanceof window.Element))throw new Error("No valid Element given");validateOptionsDefinition(t);const n=mitt(),r=getInitialValues(e,t,n);let i=createElementObserver(e,t,r,n);const a=Object.create(null);return n.on("change",({option:e,value:t,oldValue:n})=>{"function"==typeof a[e]&&a[e](t,n)}),{options:createOptionsDefInterface(t,e,r,n),onChange:a,on(e,t){return n.on(e,t),this},off(e,t){return n.off(e,t),this},merge(a){validateOptionsDefinition(a),Object.assign(t,a);const o=getInitialValues(e,a,n);Object.assign(r,o),this.options=createOptionsDefInterface(t,e,r,n),i.disconnect(),i=createElementObserver(e,t,r,n)},destroy(){i.disconnect()}}}const presetTypes=new Map([[null,{validate:e=>null==e,serialize:e=>"null",unserialize:e=>JSON.parse(e)}],[Boolean,{validate:e=>"boolean"==typeof e,serialize:e=>e?"":void 0,unserialize:e=>{if(void 0===e||"false"===e)return!1;if(""===e||"true"===e)return!0;throw new Error("Invalidly serialized Boolean")}}],[Number,{validate:e=>"number"==typeof e&&!isNaN(e),serialize:e=>JSON.stringify(e),unserialize:e=>+e}],[Array,{validate:e=>Array.isArray(e),serialize:e=>JSON.stringify(e),unserialize:e=>JSON.parse(e)}],[Object,{validate:e=>"object"==typeof e&&!Array.isArray(e),serialize:e=>JSON.stringify(e),unserialize:e=>JSON.parse(e)}],[Function,{validate:e=>"function"==typeof e,serialize:e=>String(e),unserialize:value=>eval(`(${value})`)}],[String,{validate:e=>"string"==typeof e,serialize:e=>e,unserialize:e=>e}]]);return htmlApi}();
